<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tema 8: Sistemas de Recuperaci√≥n - Bases de Datos Avanzadas</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-database"></i>
                <h1>Bases de Datos Avanzadas</h1>
            </div>
            <nav class="nav">
                <a href="../index.html" class="nav-link">
                    <i class="fas fa-home"></i> Inicio
                </a>
                <a href="../index.html#temas" class="nav-link">
                    <i class="fas fa-book"></i> Temas
                </a>
                <a href="../index.html#progreso" class="nav-link">
                    <i class="fas fa-chart-line"></i> Progreso
                </a>
            </nav>
        </div>
    </header>

    <!-- Topic Header -->
    <section class="topic-header">
        <div class="container">
            <a href="../index.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Volver al Inicio
            </a>
            <h1>Tema 8: Sistemas de Recuperaci√≥n</h1>
            <p>Mecanismos de recuperaci√≥n ante fallos y transacciones abortadas</p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Conceptos Clave -->
            <section id="conceptos" class="section">
                <h2>
                    <div class="section-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    Conceptos Clave
                </h2>
                
                <!-- Introducci√≥n -->
                <div class="concept-card">
                    <h3>Introducci√≥n</h3>
                    <p>Desde el punto de vista del software es normal enfrentarse a situaciones en las que se produce un fallo. Los sistemas gestores de bases de datos no est√°n exentos de ellos. Sin embargo, el usuario del sistema gestor espera ciertas caracter√≠sticas que garanticen el funcionamiento de sus aplicaciones.</p>
                    
                    <div class="concept-details">
                        <p>Atendiendo a las propiedades <strong>ACID</strong> de las transacciones, estas deben cumplirse aunque se produzca un fallo interno o externo en la base de datos. Por esta raz√≥n, el <strong>esquema de recuperaci√≥n</strong> de la base de datos se convierte en un elemento fundamental.</p>
                        
                        <p>De este sistema depende la <strong>consistencia</strong>, <strong>disponibilidad</strong> y <strong>tiempo de p√©rdida de servicio</strong> para resolver un posible fallo. N√≥tese que el tiempo de recuperaci√≥n ante un fallo debe ser <strong>m√≠nimo</strong>.</p>
                        
                        <!-- Diagrama de Importancia del Sistema de Recuperaci√≥n -->
                        <div class="diagram-container" style="margin-top: 20px;">
                            <h4>Importancia del Sistema de Recuperaci√≥n</h4>
                            <div class="mermaid">
graph TB
    SGBD["Sistema Gestor de<br/>Bases de Datos"]
    FALLOS["Posibles Fallos"]
    RECUPERACION["Sistema de<br/>Recuperaci√≥n"]
    PROPIEDADES["Propiedades ACID"]
    
    SGBD --> FALLOS
    FALLOS -->|"Requiere"| RECUPERACION
    RECUPERACION -->|"Garantiza"| PROPIEDADES
    
    PROPIEDADES --> CONSISTENCIA["Consistencia"]
    PROPIEDADES --> DISPONIBILIDAD["Disponibilidad"]
    PROPIEDADES --> TIEMPO["Tiempo de<br/>Recuperaci√≥n M√≠nimo"]
    
    style SGBD fill:#667eea,stroke:#764ba2,color:#fff
    style FALLOS fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style RECUPERACION fill:#4ecdc4,stroke:#087f5b,color:#fff
    style PROPIEDADES fill:#f9ca24,stroke:#f59f00,color:#000
    style CONSISTENCIA fill:#51cf66,stroke:#2f9e44,color:#fff
    style DISPONIBILIDAD fill:#51cf66,stroke:#2f9e44,color:#fff
    style TIEMPO fill:#51cf66,stroke:#2f9e44,color:#fff
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Clasificaci√≥n de Fallos -->
                <div class="concept-card">
                    <h3>Clasificaci√≥n de Fallos</h3>
                    <p>En un sistema gestor de bases de datos los fallos se pueden dividir en diferentes categor√≠as. Los fallos m√°s comunes son:</p>
                    
                    <div class="concept-details">
                        <!-- Diagrama de Clasificaci√≥n de Fallos -->
                        <div class="diagram-container">
                            <h4>Tipos de Fallos en un SGBD</h4>
                            <div class="mermaid">
graph TD
    FALLOS["Fallos en SGBD"]
    
    FALLOS --> TX["Fallo en la Transacci√≥n"]
    FALLOS --> SISTEMA["Fallo del Sistema"]
    FALLOS --> DISCO["Fallo de Disco"]
    
    TX --> LOGICO["Error L√≥gico<br/>‚Ä¢ Restricci√≥n violada<br/>‚Ä¢ Entrada incorrecta"]
    TX --> ERROR_SISTEMA["Error del Sistema<br/>‚Ä¢ Estado inconsistente<br/>‚Ä¢ Procesos bloqueados"]
    
    SISTEMA --> CAIDA["Ca√≠da del Sistema<br/>‚Ä¢ Fallo hardware<br/>‚Ä¢ Corte el√©ctrico<br/>‚Ä¢ Memoria vol√°til perdida"]
    
    DISCO --> CORRUPCION["Corrupci√≥n de Datos<br/>‚Ä¢ Exceso de uso<br/>‚Ä¢ Fallo hardware<br/>‚Ä¢ Requiere backups"]
    
    style FALLOS fill:#667eea,stroke:#764ba2,color:#fff
    style TX fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style SISTEMA fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style DISCO fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style LOGICO fill:#ffd43b,stroke:#f59f00,color:#000
    style ERROR_SISTEMA fill:#ffd43b,stroke:#f59f00,color:#000
    style CAIDA fill:#ffd43b,stroke:#f59f00,color:#000
    style CORRUPCION fill:#ffd43b,stroke:#f59f00,color:#000
                            </div>
                        </div>

                        <h4>Tipos de Fallos Detallados:</h4>
                        
                        <div style="margin-top: 20px;">
                            <h5 style="color: #667eea; margin-bottom: 10px;">
                                <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                                1. Fallo en la Transacci√≥n
                            </h5>
                            <p>En una transacci√≥n abortada pueden producirse fallos por diferentes motivos:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Error l√≥gico:</strong> Puede existir una restricci√≥n l√≥gica en el sistema que evite que esa transacci√≥n se ejecute correctamente. Por ejemplo, una entrada incorrecta.</li>
                                <li><strong>Error del sistema:</strong> En este caso el sistema se puede encontrar en un estado inconsistente, por ejemplo los procesos bloqueados por una mala soluci√≥n en concurrencia.</li>
                                <li><strong>Ca√≠da del sistema:</strong> Este error se debe normalmente a un mal funcionamiento de un dispositivo hardware (o corte de suministro el√©ctrico). Como consecuencia la m√°quina se apaga y se pierde la memoria no permanente. La transacci√≥n en ejecuci√≥n no debe continuar. Los soportes de memoria permanente (discos) no se ven afectados.</li>
                                <li><strong>Fallo de disco:</strong> Debido a un fallo hardware pero en el dispositivo de almacenamiento vol√°til. Puede ocurrir por diferentes motivos como por ejemplo un exceso de uso, un corte de suministro el√©ctrico, etc. La informaci√≥n se corrompe y es necesario ejecutar procesos de recuperaci√≥n de informaci√≥n a trav√©s de los backups existentes.</li>
                            </ul>
                        </div>

                        <div style="margin-top: 25px; padding: 15px; background: #e3f2fd; border-radius: 6px; border-left: 4px solid #2196F3;">
                            <h5 style="color: #1976D2; margin-bottom: 10px;">
                                <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                                Algoritmos de Recuperaci√≥n
                            </h5>
                            <p style="margin-bottom: 10px;">Dependiendo del tipo de fallo se selecciona una forma de recuperaci√≥n que usan diferentes tipos de algoritmos. Estos algoritmos constan de dos partes:</p>
                            <ol style="margin-left: 20px;">
                                <li><strong>Tareas de preparaci√≥n ante posibles fallos:</strong> Son aquellas que se ejecutan durante el funcionamiento normal del sistema con el fin de asegurar que, si se produce un fallo, este se pueda recuperar.</li>
                                <li><strong>Acciones posteriores a un fallo:</strong> Se encargan de comprobar la consistencia de la base de datos y asegurar las propiedades ACID.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- Estructuras de Almacenamiento -->
                <div class="concept-card">
                    <h3>Estructuras de Almacenamiento</h3>
                    <p>La base de datos puede combinar diferentes formas de almacenamiento. Para entender el funcionamiento de las propiedades de atomicidad y durabilidad es necesario estudiar los diferentes medios de almacenamiento:</p>
                    
                    <div class="concept-details">
                        <!-- Diagrama de Estructuras de Almacenamiento -->
                        <div class="diagram-container">
                            <h4>Jerarqu√≠a de Almacenamiento</h4>
                            <div class="mermaid">
graph TB
    ALMACENAMIENTO["Almacenamiento"]
    
    ALMACENAMIENTO --> VOLATIL["Almacenamiento Vol√°til<br/>‚Ä¢ Memoria RAM<br/>‚Ä¢ Cache del procesador<br/>‚Ä¢ Se pierde al apagar"]
    
    ALMACENAMIENTO --> NO_VOLATIL["Almacenamiento No Vol√°til<br/>‚Ä¢ Discos duros (HDD)<br/>‚Ä¢ SSD<br/>‚Ä¢ Persiste al apagar"]
    
    ALMACENAMIENTO --> ESTABLE["Almacenamiento Estable<br/>‚Ä¢ Aproximaci√≥n mediante<br/>  replicaci√≥n y backups<br/>‚Ä¢ Garantiza durabilidad"]
    
    VOLATIL -->|"R√°pido pero<br/>temporal"| CARACTERISTICAS1["‚Ä¢ Acceso r√°pido<br/>‚Ä¢ Capacidad limitada<br/>‚Ä¢ Costo por GB alto"]
    
    NO_VOLATIL -->|"Persistente<br/>pero m√°s lento"| CARACTERISTICAS2["‚Ä¢ Acceso m√°s lento<br/>‚Ä¢ Mayor capacidad<br/>‚Ä¢ Costo por GB menor"]
    
    ESTABLE -->|"M√°xima<br/>confiabilidad"| CARACTERISTICAS3["‚Ä¢ Replicaci√≥n<br/>‚Ä¢ Backups m√∫ltiples<br/>‚Ä¢ Tolerancia a fallos"]
    
    style ALMACENAMIENTO fill:#667eea,stroke:#764ba2,color:#fff
    style VOLATIL fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style NO_VOLATIL fill:#4ecdc4,stroke:#087f5b,color:#fff
    style ESTABLE fill:#51cf66,stroke:#2f9e44,color:#fff
    style CARACTERISTICAS1 fill:#ffe0e0,stroke:#ff6b6b
    style CARACTERISTICAS2 fill:#e0f7f4,stroke:#4ecdc4
    style CARACTERISTICAS3 fill:#e8f5e9,stroke:#51cf66
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <h4>Caracter√≠sticas de cada tipo:</h4>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Almacenamiento vol√°til:</strong> Memoria que se pierde cuando el sistema se apaga. Es muy r√°pida pero temporal.</li>
                                <li><strong>Almacenamiento no vol√°til:</strong> Persiste despu√©s de apagar el sistema. Es m√°s lenta que la memoria vol√°til pero mantiene los datos.</li>
                                <li><strong>Almacenamiento estable:</strong> Se centra en asegurar que los datos ¬´nunca¬ª puedan perderse. Esto se puede imitar realizando aproximaciones de almacenamiento mediante replicaci√≥n y backups m√∫ltiples.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Recuperaci√≥n y Atomicidad -->
                <div class="concept-card">
                    <h3>Recuperaci√≥n y Atomicidad</h3>
                    <p>Durante la ejecuci√≥n de una transacci√≥n puede producirse un error. En este caso no se sabe si esta se ha ejecutado correctamente o no.</p>
                    
                    <div class="concept-details">
                        <p>Teniendo en mente las dos alternativas se puede:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Volver a ejecutar la transacci√≥n:</strong> Se asume que no ha tenido efecto en la base de datos.</li>
                            <li><strong>No volver a ejecutar la transacci√≥n:</strong> Se asume que se ha ejecutado correctamente.</li>
                        </ul>
                        
                        <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                            <p><strong>‚ö†Ô∏è Problema:</strong> Independientemente de la opci√≥n escogida, la base de datos queda en un estado inconsistente. Claramente este esquema de recuperaci√≥n no es v√°lido.</p>
                            <p style="margin-top: 10px;"><strong>üí° Soluci√≥n:</strong> Si analizamos el problema, vemos que esta situaci√≥n se produce por no tener certeza sobre si la transacci√≥n ha finalizado correctamente o no. Por eso es necesario implementar un <strong>sistema de registro hist√≥rico (log)</strong> que permita determinar el estado exacto de cada transacci√≥n.</p>
                        </div>

                        <!-- Diagrama del Problema de Recuperaci√≥n -->
                        <div class="diagram-container" style="margin-top: 20px;">
                            <h4>Problema de Recuperaci√≥n sin Log</h4>
                            <div class="mermaid">
flowchart TD
    TX["Transacci√≥n en<br/>Ejecuci√≥n"]
    FALLO["Fallo del Sistema"]
    DECISION{"¬øQu√© hacer?"}
    
    TX --> FALLO
    FALLO --> DECISION
    
    DECISION -->|"Opci√≥n 1"| RE_EJECUTAR["Re-ejecutar<br/>Transacci√≥n"]
    DECISION -->|"Opci√≥n 2"| NO_RE_EJECUTAR["No re-ejecutar<br/>Transacci√≥n"]
    
    RE_EJECUTAR --> PROBLEMA1["‚ùå Si ya se ejecut√≥:<br/>Datos duplicados<br/>Estado inconsistente"]
    NO_RE_EJECUTAR --> PROBLEMA2["‚ùå Si no se ejecut√≥:<br/>Datos perdidos<br/>Estado inconsistente"]
    
    PROBLEMA1 --> INCONSISTENCIA["Base de Datos<br/>Inconsistente"]
    PROBLEMA2 --> INCONSISTENCIA
    
    INCONSISTENCIA --> SOLUCION["‚úÖ Soluci√≥n:<br/>Sistema de Log<br/>Hist√≥rico"]
    
    style TX fill:#667eea,stroke:#764ba2,color:#fff
    style FALLO fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style DECISION fill:#ffd43b,stroke:#f59f00,color:#000
    style PROBLEMA1 fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style PROBLEMA2 fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style INCONSISTENCIA fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style SOLUCION fill:#51cf66,stroke:#2f9e44,color:#fff
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recuperaci√≥n basada en Registro Hist√≥rico -->
                <div class="concept-card">
                    <h3>Recuperaci√≥n basada en Registro Hist√≥rico</h3>
                    <p>El registro hist√≥rico es la forma m√°s utilizada para almacenar todas las modificaciones realizadas en la base de datos.</p>
                    
                    <div class="concept-details">
                        <h4>Estructura del Registro Hist√≥rico</h4>
                        <p>Un registro del registro hist√≥rico debe tener la misma estructura en el sistema. Al menos tiene que tener los siguientes campos:</p>
                        
                        <!-- Diagrama de Estructura del Log -->
                        <div class="diagram-container" style="margin-top: 15px;">
                            <h4>Estructura de un Registro de Log</h4>
                            <div class="mermaid">
graph LR
    LOG_RECORD["Registro de Log"]
    
    LOG_RECORD --> TX_ID["Identificador de<br/>Transacci√≥n<br/>(TX_ID)"]
    LOG_RECORD --> DATA_ID["Identificador del<br/>Elemento de Datos<br/>(Ubicaci√≥n en disco)"]
    LOG_RECORD --> VALOR_ANTERIOR["Valor Anterior<br/>(Before Image)"]
    LOG_RECORD --> VALOR_NUEVO["Valor Nuevo<br/>(After Image)"]
    
    style LOG_RECORD fill:#667eea,stroke:#764ba2,color:#fff
    style TX_ID fill:#4ecdc4,stroke:#087f5b,color:#fff
    style DATA_ID fill:#4ecdc4,stroke:#087f5b,color:#fff
    style VALOR_ANTERIOR fill:#ffd43b,stroke:#f59f00,color:#000
    style VALOR_NUEVO fill:#51cf66,stroke:#2f9e44,color:#fff
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 6px; border-left: 4px solid #4CAF50;">
                            <h5 style="color: #2e7d32; margin-bottom: 10px;">
                                <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                                Principio Write-Ahead Logging (WAL)
                            </h5>
                            <p><strong>Regla fundamental:</strong> Al realizar una escritura es necesario crear el registro hist√≥rico <strong>ANTES</strong> de modificar nada en la base de datos. Una vez que se crea el registro hist√≥rico se procede a modificar la base de datos.</p>
                            <p style="margin-top: 10px;">Gracias a este comportamiento se puede realizar operaciones de <strong>deshacer (undo)</strong> para volver a valores anteriores. Normalmente estos registros hist√≥ricos suelen tener un tama√±o determinado ya que pueden suponer un gran consumo de recursos.</p>
                        </div>

                        <h4 style="margin-top: 25px;">T√©cnicas de Recuperaci√≥n:</h4>
                        
                        <div style="margin-top: 15px;">
                            <h5 style="color: #667eea; margin-bottom: 10px;">
                                <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                1. Modificaci√≥n Diferida (Deferred Modification)
                            </h5>
                            <p>La t√©cnica de modificaci√≥n diferida permite asegurar la atomicidad de las transacciones gracias a que se utiliza el registro hist√≥rico para <strong>retrasar la ejecuci√≥n de operaciones</strong> hasta que la transacci√≥n se compromete parcialmente.</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>En ese caso la informaci√≥n del registro se utiliza para realizar las modificaciones de manera diferida.</li>
                                <li>Cuando se desea deshacer una operaci√≥n, debe asegurarse que es una <strong>operaci√≥n idempotente</strong>, es decir, solo tiene efecto la primera vez que se ejecuta.</li>
                            </ul>
                        </div>

                        <div style="margin-top: 20px;">
                            <h5 style="color: #667eea; margin-bottom: 10px;">
                                <i class="fas fa-bolt" style="margin-right: 8px;"></i>
                                2. Modificaci√≥n Inmediata (Immediate Modification)
                            </h5>
                            <p>Como alternativa a la modificaci√≥n diferida, tenemos la modificaci√≥n inmediata. En este caso, las modificaciones se realizan <strong>sin esperar</strong> a que la transacci√≥n est√© comprometida, pues se hacen cuando la transacci√≥n est√° activa.</p>
                            <p style="margin-top: 10px;">Cuando se produce un error se ejecuta la operaci√≥n <strong>deshacer (undo)</strong> que se encarga de:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>Restaurar el valor de todos los elementos actualizados a sus valores anteriores.</li>
                                <li>Cambiar el valor de todos los elementos actualizados por la transacci√≥n.</li>
                            </ul>
                        </div>

                        <!-- Diagrama Comparativo -->
                        <div class="diagram-container" style="margin-top: 25px;">
                            <h4>Comparaci√≥n: Modificaci√≥n Diferida vs Inmediata</h4>
                            <div class="mermaid">
graph TB
    subgraph DIFERIDA["Modificaci√≥n Diferida"]
        D1["1. Escribir en Log"]
        D2["2. Esperar COMMIT"]
        D3["3. Aplicar cambios<br/>a la BD"]
        D1 --> D2 --> D3
    end
    
    subgraph INMEDIATA["Modificaci√≥n Inmediata"]
        I1["1. Escribir en Log"]
        I2["2. Aplicar cambios<br/>a la BD inmediatamente"]
        I3["3. Si falla: UNDO<br/>desde Log"]
        I1 --> I2 --> I3
    end
    
    DIFERIDA -->|"Ventaja"| VENTAJA_D["Menos trabajo<br/>de UNDO"]
    INMEDIATA -->|"Ventaja"| VENTAJA_I["Mejor rendimiento<br/>durante ejecuci√≥n"]
    
    style DIFERIDA fill:#e3f2fd,stroke:#2196F3,color:#000
    style INMEDIATA fill:#fff3e0,stroke:#ff9800,color:#000
    style VENTAJA_D fill:#51cf66,stroke:#2f9e44,color:#fff
    style VENTAJA_I fill:#51cf66,stroke:#2f9e44,color:#fff
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transacciones Concurrentes y Recuperaci√≥n -->
                <div class="concept-card">
                    <h3>Transacciones Concurrentes y Recuperaci√≥n</h3>
                    <p>El esquema de recuperaci√≥n debe interactuar con el planificador de concurrencia del sistema operativo.</p>
                    
                    <div class="concept-details">
                        <p>La problem√°tica de las transacciones concurrentes se puede observar cuando varias transacciones acceden al mismo dato. Cuando se produce un error en el sistema de bases de datos no es trivial averiguar las transacciones que est√°n afectadas.</p>
                        
                        <div style="margin-top: 15px; padding: 15px; background: #ffebee; border-radius: 6px; border-left: 4px solid #f44336;">
                            <p><strong>‚ö†Ô∏è Restricci√≥n importante:</strong> Por lo tanto, se establece una restricci√≥n de modificaci√≥n de datos, pues una transacci√≥n no puede modificar un dato que est√° siendo accedido por otra transacci√≥n.</p>
                        </div>

                        <!-- Diagrama de Concurrencia y Recuperaci√≥n -->
                        <div class="diagram-container" style="margin-top: 20px;">
                            <h4>Interacci√≥n entre Concurrencia y Recuperaci√≥n</h4>
                            <div class="mermaid">
graph TB
    SISTEMA["Sistema de BD"]
    
    SISTEMA --> CONCURRENCIA["Planificador de<br/>Concurrencia"]
    SISTEMA --> RECUPERACION["Sistema de<br/>Recuperaci√≥n"]
    
    CONCURRENCIA --> BLOQUEOS["Gesti√≥n de<br/>Bloqueos"]
    CONCURRENCIA --> AISLAMIENTO["Niveles de<br/>Aislamiento"]
    
    RECUPERACION --> LOG["Registro<br/>Hist√≥rico"]
    RECUPERACION --> CHECKPOINT["Checkpoints"]
    
    BLOQUEOS --> RESTRICCION["Restricci√≥n:<br/>No modificar datos<br/>accedidos por otra TX"]
    LOG --> RESTRICCION
    
    RESTRICCION --> CONSISTENCIA["Garantiza<br/>Consistencia"]
    
    style SISTEMA fill:#667eea,stroke:#764ba2,color:#fff
    style CONCURRENCIA fill:#4ecdc4,stroke:#087f5b,color:#fff
    style RECUPERACION fill:#f9ca24,stroke:#f59f00,color:#000
    style RESTRICCION fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style CONSISTENCIA fill:#51cf66,stroke:#2f9e44,color:#fff
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alta Disponibilidad en Bases de Datos -->
                <div class="concept-card">
                    <h3>Alta Disponibilidad en Bases de Datos</h3>
                    <p>En la actualidad los servidores de partes de datos juegan un papel muy importante en las organizaciones, por eso es necesario contar con planes de recuperaci√≥n ante desastres.</p>
                    
                    <div class="concept-details">
                        <p>Las soluciones de alta disponibilidad est√°n pensadas para aquellos sistemas que requieren estar activos <strong>24/7</strong> y que puedan sobreponerse a cualquier incidente de manera r√°pida. Los principales proveedores de bases de datos ofrecen servicios para garantizar la alta disponibilidad de sus sistemas.</p>

                        <!-- Soluciones Oracle -->
                        <div style="margin-top: 25px;">
                            <h4 style="color: #667eea; margin-bottom: 15px;">
                                <i class="fas fa-database" style="margin-right: 8px;"></i>
                                Soluciones de Alta Disponibilidad en Oracle
                            </h4>
                            <p>Oracle ofrece distintos servicios para dar soporte a la alta disponibilidad. Para todos los fallos relacionados con errores de hardware propone lo siguiente:</p>
                            
                            <div class="comparison-table" style="margin-top: 15px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Caracter√≠stica</th>
                                            <th>Descripci√≥n</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>Enterprise Grids</strong></td>
                                            <td>En un entorno de Oracle RAC, Oracle Database se ejecuta en dos o m√°s sistemas en un cl√∫ster al mismo tiempo que accede a una √∫nica base de datos compartida. Un solo sistema de base de datos abarca varios sistemas de hardware, pero para la aplicaci√≥n aparece como una √∫nica base de datos.</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Oracle Data Guard</strong></td>
                                            <td>Data Guard permite mantener una o m√°s copias de una base de datos de producci√≥n, llamada base de datos de reserva, que puede residir en diferentes continentes o en el mismo centro de datos. Si la base de datos principal no est√° disponible debido a una interrupci√≥n, entonces Data Guard puede cambiar cualquier base de datos en espera a la funci√≥n principal, minimizando el tiempo de inactividad.</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Global Data Services</strong></td>
                                            <td>Global Data Services automatiza y centraliza la configuraci√≥n, el mantenimiento y el monitoreo de una base de datos en la nube.</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Fast Start Fault Recovery</strong></td>
                                            <td>Una causa com√∫n del tiempo de inactividad no planificado es un fallo o fallo del sistema. Oracle Database proporciona una tecnolog√≠a de recuperaci√≥n r√°pida de fallos que limita autom√°ticamente el tiempo de recuperaci√≥n de la instancia de la base de datos.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 6px; border-left: 4px solid #2196F3;">
                                <h5 style="color: #1976D2; margin-bottom: 10px;">
                                    <i class="fas fa-tools" style="margin-right: 8px;"></i>
                                    Recovery Manager (RMAN)
                                </h5>
                                <p>Para los problemas relacionados con los fallos en el almacenamiento, Oracle propone <strong>The Recovery Manager (RMAN)</strong>. RMAN proporciona una base completa para hacer copias de seguridad y recuperaci√≥n de manera eficiente de la base de datos Oracle.</p>
                                <p style="margin-top: 10px;">RMAN puede realizar copias de seguridad de datos, restaurar datos de una copia de seguridad anterior y recuperar cambios en esos datos hasta el momento antes de que se produjera el fallo. Est√° dise√±ado para trabajar √≠ntimamente con el servidor, proporcionando detecci√≥n de corrupci√≥n a nivel de bloque durante la copia de seguridad y restauraci√≥n.</p>
                            </div>
                        </div>

                        <!-- Soluciones SQL Server -->
                        <div style="margin-top: 30px;">
                            <h4 style="color: #667eea; margin-bottom: 15px;">
                                <i class="fas fa-server" style="margin-right: 8px;"></i>
                                Soluciones de Alta Disponibilidad en SQL Server
                            </h4>
                            <p>SQL Server ofrece servicios desde m√°s b√°sicos hasta m√°s avanzados:</p>
                            
                            <div style="margin-top: 15px;">
                                <h5 style="color: #495057; margin-bottom: 10px;">1. Log Shipping</h5>
                                <p>En un primer nivel cuenta con <strong>Log Shipping</strong>, en el que implementa un sistema automatizado para mantener uno o varios servidores secundarios con una copia de seguridad restaur√°ndose autom√°ticamente de forma as√≠ncrona cada x minutos. En caso de fallo necesita intervenci√≥n manual para cargar la base de datos secundaria.</p>
                            </div>

                            <div style="margin-top: 20px;">
                                <h5 style="color: #495057; margin-bottom: 10px;">2. Database Mirroring (Deprecado)</h5>
                                <p>Database Mirroring, mantenido hasta la versi√≥n SQL Server 2017, en la actualidad ha sido reemplazado por los grupos AlwaysOn. Database Mirroring permite configurar una base de datos refleja a un √∫nico servidor secundario, la sincronizaci√≥n de datos puede ser s√≠ncrona o as√≠ncrona, puede configurarse con una tercera instancia testigo, para que en caso de fallo de la principal cambie autom√°ticamente como activa la del servidor secundario.</p>
                            </div>

                            <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 6px; border-left: 4px solid #4CAF50;">
                                <h5 style="color: #2e7d32; margin-bottom: 10px;">
                                    <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                                    3. AlwaysOn Availability Groups (Recomendado)
                                </h5>
                                <p>Aunque la recomendaci√≥n actual de Microsoft es usar los <strong>grupos de disponibilidad AlwaysOn</strong>. Un grupo de disponibilidad admite un entorno replicado de un conjunto discreto de bases de datos de usuario, conocido como bases de datos de disponibilidad.</p>
                                <p style="margin-top: 10px;">Un grupo de disponibilidad se puede crear para:</p>
                                <ul style="margin-left: 20px; margin-top: 10px;">
                                    <li><strong>Alta disponibilidad:</strong> Un grupo de bases de datos que realizan la conmutaci√≥n por error conjuntamente.</li>
                                    <li><strong>Escalado de lectura:</strong> Un grupo de bases de datos que se copian en otras instancias de SQL Server para cargas de trabajo de solo lectura.</li>
                                </ul>
                                <p style="margin-top: 10px;"><strong>Caracter√≠sticas:</strong> Un grupo de disponibilidad admite un conjunto de bases de datos principales y entre uno y ocho conjuntos de las bases de datos secundarias correspondientes. Las bases de datos secundarias no son copias de seguridad.</p>
                            </div>
                        </div>

                        <!-- Diagrama de Alta Disponibilidad -->
                        <div class="diagram-container" style="margin-top: 25px;">
                            <h4>Arquitectura de Alta Disponibilidad</h4>
                            <div class="mermaid">
graph TB
    APLICACION["Aplicaci√≥n"]
    
    APLICACION --> PRINCIPAL["Base de Datos<br/>Principal<br/>(Activa)"]
    
    PRINCIPAL -->|"Replicaci√≥n"| SECUNDARIA1["Base de Datos<br/>Secundaria 1<br/>(Standby)"]
    PRINCIPAL -->|"Replicaci√≥n"| SECUNDARIA2["Base de Datos<br/>Secundaria 2<br/>(Standby)"]
    
    FALLO["Fallo en Principal"]
    PRINCIPAL -.->|"Si falla"| FALLO
    
    FALLO --> FAILOVER["Conmutaci√≥n por<br/>Error (Failover)"]
    FAILOVER --> SECUNDARIA1
    
    SECUNDARIA1 -->|"Promovida a"| NUEVA_PRINCIPAL["Nueva Principal<br/>(Activa)"]
    
    style APLICACION fill:#667eea,stroke:#764ba2,color:#fff
    style PRINCIPAL fill:#51cf66,stroke:#2f9e44,color:#fff
    style SECUNDARIA1 fill:#4ecdc4,stroke:#087f5b,color:#fff
    style SECUNDARIA2 fill:#4ecdc4,stroke:#087f5b,color:#fff
    style FALLO fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style FAILOVER fill:#ffd43b,stroke:#f59f00,color:#000
    style NUEVA_PRINCIPAL fill:#51cf66,stroke:#2f9e44,color:#fff
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ejemplos Pr√°cticos -->
            <section id="ejemplos" class="section">
                <h2>
                    <div class="section-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    Ejemplos Pr√°cticos
                </h2>

                <div class="example-grid">
                    <div class="example-card">
                        <h4>Ejemplo 1: Configuraci√≥n de WAL en PostgreSQL</h4>
                        <p><strong>Escenario:</strong> Configurar Write-Ahead Logging para garantizar durabilidad</p>
                        <div class="code-block">
<pre>-- Configuraci√≥n de WAL en postgresql.conf
wal_level = replica
max_wal_size = 4GB
min_wal_size = 1GB
checkpoint_completion_target = 0.9
checkpoint_timeout = 15min
checkpoint_warning = 30s

-- Configuraci√≥n de archiving
archive_mode = on
archive_command = 'cp %p /backup/wal_archive/%f'
archive_timeout = 300

-- Verificar estado del WAL
SELECT * FROM pg_stat_archiver;

-- Verificar checkpoints
SELECT * FROM pg_stat_bgwriter;

-- Monitoreo de WAL
SELECT 
    pg_current_wal_lsn() as current_lsn,
    pg_wal_lsn_diff(pg_current_wal_lsn(), '0/0') as wal_bytes;</pre>
                        </div>
                        <p><strong>Explicaci√≥n:</strong> Configuraci√≥n completa del sistema de logging de PostgreSQL para garantizar recuperaci√≥n ante fallos.</p>
                    </div>

                    <div class="example-card">
                        <h4>Ejemplo 2: Backup y Restore en PostgreSQL</h4>
                        <p><strong>Escenario:</strong> Realizar backup completo y restaurar desde un punto espec√≠fico</p>
                        <div class="code-block">
<pre>-- Backup base completo
pg_basebackup -D /backup/base_backup -Ft -z -P

-- Backup l√≥gico con pg_dump
pg_dump -Fc -f backup.dump nombre_bd

-- Restaurar desde backup
-- 1. Detener PostgreSQL
systemctl stop postgresql

-- 2. Restaurar archivos de datos
rm -rf /var/lib/postgresql/data/*
tar -xzf /backup/base_backup/base.tar.gz -C /var/lib/postgresql/data/

-- 3. Configurar recovery.conf (PostgreSQL 12+)
-- Crear postgresql.auto.conf o recovery.signal
echo "restore_command = 'cp /backup/wal_archive/%f %p'" > recovery.conf
echo "recovery_target_time = '2024-01-15 10:00:00'"

-- 4. Iniciar PostgreSQL
systemctl start postgresql</pre>
                        </div>
                        <p><strong>Explicaci√≥n:</strong> Proceso completo de backup y restauraci√≥n punto-en-tiempo usando WAL archiving.</p>
                    </div>

                    <div class="example-card">
                        <h4>Ejemplo 3: Oracle RMAN - Backup Completo</h4>
                        <p><strong>Escenario:</strong> Usar Recovery Manager para backup y recuperaci√≥n</p>
                        <div class="code-block">
<pre>-- Conectar a RMAN
rman target /

-- Backup completo de la base de datos
BACKUP DATABASE PLUS ARCHIVELOG;

-- Backup de tablespace espec√≠fico
BACKUP TABLESPACE usuarios;

-- Backup incremental
BACKUP INCREMENTAL LEVEL 1 DATABASE;

-- Listar backups
LIST BACKUP;

-- Restaurar y recuperar
RESTORE DATABASE;
RECOVER DATABASE;

-- Recuperaci√≥n punto-en-tiempo
RUN {
    SET UNTIL TIME "TO_DATE('2024-01-15 10:00:00', 'YYYY-MM-DD HH24:MI:SS')";
    RESTORE DATABASE;
    RECOVER DATABASE;
}</pre>
                        </div>
                        <p><strong>Explicaci√≥n:</strong> Uso de RMAN para realizar backups completos, incrementales y recuperaci√≥n punto-en-tiempo.</p>
                    </div>

                    <div class="example-card">
                        <h4>Ejemplo 4: SQL Server AlwaysOn - Configuraci√≥n</h4>
                        <p><strong>Escenario:</strong> Configurar grupo de disponibilidad AlwaysOn</p>
                        <div class="code-block">
<pre>-- Habilitar AlwaysOn
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'always on availability groups', 1;
RECONFIGURE;

-- Crear grupo de disponibilidad
CREATE AVAILABILITY GROUP AG_Ejemplo
WITH (
    AUTOMATED_BACKUP_PREFERENCE = PRIMARY,
    FAILURE_CONDITION_LEVEL = 3,
    HEALTH_CHECK_TIMEOUT = 30000
)
FOR DATABASE MiBaseDeDatos
REPLICA ON
    'SERVER1' WITH (
        ENDPOINT_URL = 'TCP://server1:5022',
        AVAILABILITY_MODE = SYNCHRONOUS_COMMIT,
        FAILOVER_MODE = AUTOMATIC,
        SEEDING_MODE = AUTOMATIC
    ),
    'SERVER2' WITH (
        ENDPOINT_URL = 'TCP://server2:5022',
        AVAILABILITY_MODE = SYNCHRONOUS_COMMIT,
        FAILOVER_MODE = AUTOMATIC,
        SEEDING_MODE = AUTOMATIC
    );

-- Agregar base de datos al grupo
ALTER AVAILABILITY GROUP AG_Ejemplo
ADD DATABASE MiBaseDeDatos;

-- Verificar estado
SELECT 
    ag.name AS 'Availability Group',
    ar.replica_server_name AS 'Replica',
    ar.availability_mode_desc AS 'Availability Mode',
    ar.failover_mode_desc AS 'Failover Mode'
FROM sys.availability_groups ag
JOIN sys.availability_replicas ar ON ag.group_id = ar.group_id;</pre>
                        </div>
                        <p><strong>Explicaci√≥n:</strong> Configuraci√≥n de alta disponibilidad con AlwaysOn Availability Groups en SQL Server.</p>
                    </div>

                    <div class="example-card">
                        <h4>Ejemplo 5: Simulaci√≥n de Recuperaci√≥n con Log</h4>
                        <p><strong>Escenario:</strong> Simular proceso de recuperaci√≥n usando registro hist√≥rico</p>
                        <div class="code-block">
<pre>-- Tabla de ejemplo
CREATE TABLE cuentas (
    id INT PRIMARY KEY,
    saldo DECIMAL(10,2)
);

-- Transacci√≥n que falla
BEGIN TRANSACTION;

-- Operaci√≥n 1: Registrar en log (simulado)
-- Log: TX-001, UPDATE, cuentas(id=1), saldo=1000, saldo=1500
UPDATE cuentas SET saldo = 1500 WHERE id = 1;

-- Operaci√≥n 2: Registrar en log
-- Log: TX-001, UPDATE, cuentas(id=2), saldo=2000, saldo=2500
UPDATE cuentas SET saldo = 2500 WHERE id = 2;

-- FALLO DEL SISTEMA (simulado)
-- El sistema se reinicia

-- Proceso de recuperaci√≥n:
-- 1. An√°lisis: Identificar transacciones activas
-- 2. Redo: Reaplicar operaciones confirmadas desde log
-- 3. Undo: Deshacer operaciones no confirmadas

-- Si TX-001 no ten√≠a COMMIT:
ROLLBACK; -- Deshacer cambios usando valores anteriores del log

-- Si TX-001 ten√≠a COMMIT:
-- Los cambios ya est√°n aplicados, no se necesita hacer nada</pre>
                        </div>
                        <p><strong>Explicaci√≥n:</strong> Proceso de recuperaci√≥n usando el registro hist√≥rico para determinar qu√© operaciones deshacer o reaplicar.</p>
                    </div>

                    <div class="example-card">
                        <h4>Ejemplo 6: Checkpoints en MySQL</h4>
                        <p><strong>Escenario:</strong> Configurar y monitorear checkpoints</p>
                        <div class="code-block">
<pre>-- Ver configuraci√≥n de InnoDB
SHOW VARIABLES LIKE 'innodb%checkpoint%';

-- Configurar checkpoints
SET GLOBAL innodb_max_dirty_pages_pct = 75;
SET GLOBAL innodb_checkpoint_disabled = 0;

-- Forzar checkpoint manual
FLUSH LOGS;

-- Verificar estado de checkpoints
SHOW ENGINE INNODB STATUS\G

-- En la secci√≥n LOG ver√°s:
-- Log sequence number: [n√∫mero]
-- Log flushed up to: [n√∫mero]
-- Pages flushed up to: [n√∫mero]

-- Monitoreo de actividad de checkpoint
SELECT 
    VARIABLE_NAME,
    VARIABLE_VALUE
FROM performance_schema.global_status
WHERE VARIABLE_NAME LIKE 'Innodb%checkpoint%';</pre>
                        </div>
                        <p><strong>Explicaci√≥n:</strong> Configuraci√≥n y monitoreo de checkpoints en MySQL/InnoDB para optimizar la recuperaci√≥n.</p>
                    </div>
                </div>
            </section>

            <!-- Actividades de Refuerzo -->
            <section id="actividades" class="section">
                <h2>
                    <div class="section-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    Actividades de Refuerzo
                </h2>

                <div class="activity-card">
                    <h3>Actividad 1: Test Interactivo de Conocimientos</h3>
                    <p><strong>Duraci√≥n:</strong> 15-20 minutos</p>
                    <p><strong>Objetivo:</strong> Evaluar comprensi√≥n de conceptos fundamentales de sistemas de recuperaci√≥n</p>
                    
                    <div class="activity-content" id="test-container">
                        <div id="test-questions"></div>
                        <div id="test-results" style="display: none;">
                            <h3>Resultados del Test</h3>
                            <div id="results-content"></div>
                            <button id="restart-test" class="btn-primary" style="margin-top: 20px;">Reiniciar Test</button>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script src="../script.js"></script>
    <script>
        // Test Interactivo de Sistemas de Recuperaci√≥n
        const testQuestions = [
            {
                question: "¬øCu√°l es el principio fundamental del Write-Ahead Logging (WAL)?",
                options: {
                    A: "Escribir primero en la base de datos y luego en el log.",
                    B: "Escribir primero en el log y luego en la base de datos.",
                    C: "Escribir simult√°neamente en el log y en la base de datos.",
                    D: "No es necesario escribir en el log si se escribe en la base de datos."
                },
                correct: "B",
                explanation: "El principio Write-Ahead Logging (WAL) establece que se debe escribir primero en el registro hist√≥rico (log) antes de modificar la base de datos. Esto garantiza que siempre tengamos un registro de las operaciones para poder recuperar el sistema ante fallos."
            },
            {
                question: "Un fallo de disco se diferencia de una ca√≠da del sistema porque:",
                options: {
                    A: "El fallo de disco afecta solo a la memoria vol√°til.",
                    B: "El fallo de disco corrompe la informaci√≥n en el almacenamiento permanente y requiere restauraci√≥n desde backups.",
                    C: "La ca√≠da del sistema siempre requiere intervenci√≥n manual.",
                    D: "No hay diferencia entre ambos tipos de fallos."
                },
                correct: "B",
                explanation: "Un fallo de disco afecta al almacenamiento permanente (discos), corrompiendo la informaci√≥n almacenada. Esto requiere procesos de recuperaci√≥n desde backups existentes. Una ca√≠da del sistema normalmente solo afecta la memoria vol√°til, pero los discos permanecen intactos."
            },
            {
                question: "¬øQu√© informaci√≥n debe contener como m√≠nimo un registro del log hist√≥rico?",
                options: {
                    A: "Solo el identificador de transacci√≥n y el valor nuevo.",
                    B: "Identificador de transacci√≥n, identificador del elemento de datos, valor anterior y valor nuevo.",
                    C: "Solo el identificador de transacci√≥n y el tipo de operaci√≥n.",
                    D: "El timestamp y el identificador de transacci√≥n."
                },
                correct: "B",
                explanation: "Un registro del log hist√≥rico debe contener al menos: el identificador de transacci√≥n, el identificador del elemento de datos (ubicaci√≥n en disco), el valor anterior (before image) y el valor nuevo (after image). Esta informaci√≥n es esencial para realizar operaciones de undo y redo."
            },
            {
                question: "En la t√©cnica de modificaci√≥n inmediata, ¬øqu√© sucede si una transacci√≥n falla antes del COMMIT?",
                options: {
                    A: "Los cambios se mantienen en la base de datos porque ya se aplicaron.",
                    B: "Se ejecuta una operaci√≥n UNDO que restaura los valores anteriores usando el log.",
                    C: "No se puede recuperar porque los cambios ya se aplicaron.",
                    D: "Se espera a que la transacci√≥n se complete autom√°ticamente."
                },
                correct: "B",
                explanation: "En modificaci√≥n inmediata, las modificaciones se aplican a la base de datos mientras la transacci√≥n est√° activa. Si falla antes del COMMIT, se ejecuta una operaci√≥n UNDO que lee el log hist√≥rico y restaura todos los valores anteriores de los elementos modificados por esa transacci√≥n."
            },
            {
                question: "¬øCu√°l es la principal ventaja de los checkpoints en un sistema de recuperaci√≥n?",
                options: {
                    A: "Eliminan la necesidad de usar logs hist√≥ricos.",
                    B: "Reducen el tiempo de recuperaci√≥n al limitar la cantidad de log que se debe procesar.",
                    C: "Permiten evitar completamente los fallos del sistema.",
                    D: "Reemplazan la necesidad de backups."
                },
                correct: "B",
                explanation: "Los checkpoints son puntos de sincronizaci√≥n peri√≥dicos que reducen significativamente el tiempo de recuperaci√≥n. Al establecer un checkpoint, se sabe que todas las transacciones confirmadas antes del checkpoint ya est√°n escritas en disco, por lo que solo se necesita procesar el log desde el √∫ltimo checkpoint."
            },
            {
                question: "Oracle Data Guard permite:",
                options: {
                    A: "Solo realizar backups incrementales de la base de datos.",
                    B: "Mantener una o m√°s copias de la base de datos de producci√≥n (standby) que pueden activarse como principal en caso de fallo.",
                    C: "Eliminar la necesidad de logs de transacciones.",
                    D: "Solo funciona en el mismo centro de datos."
                },
                correct: "B",
                explanation: "Oracle Data Guard permite mantener una o m√°s bases de datos de reserva (standby) que pueden residir en diferentes continentes o en el mismo centro de datos. Si la base de datos principal falla, Data Guard puede cambiar autom√°ticamente cualquier base de datos en espera a la funci√≥n principal, minimizando el tiempo de inactividad."
            },
            {
                question: "¬øQu√© es Oracle RMAN (Recovery Manager)?",
                options: {
                    A: "Un m√≥dulo de Oracle para gestionar usuarios y permisos.",
                    B: "Una herramienta completa para realizar copias de seguridad y recuperaci√≥n eficiente de bases de datos Oracle, con detecci√≥n de corrupci√≥n a nivel de bloque.",
                    C: "Un sistema de monitoreo de rendimiento de consultas.",
                    D: "Una herramienta para optimizar √≠ndices."
                },
                correct: "B",
                explanation: "Oracle RMAN (Recovery Manager) es una herramienta especializada que proporciona una base completa para hacer copias de seguridad y recuperaci√≥n eficiente de bases de datos Oracle. Est√° dise√±ado para trabajar √≠ntimamente con el servidor, proporcionando detecci√≥n de corrupci√≥n a nivel de bloque durante la copia de seguridad y restauraci√≥n."
            },
            {
                question: "En SQL Server, ¬øqu√© caracter√≠stica reemplaz√≥ a Database Mirroring y es la recomendaci√≥n actual?",
                options: {
                    A: "Log Shipping.",
                    B: "AlwaysOn Availability Groups.",
                    C: "Transaction Replication.",
                    D: "Snapshot Replication."
                },
                correct: "B",
                explanation: "Database Mirroring fue mantenido hasta SQL Server 2017, pero actualmente ha sido reemplazado por los grupos AlwaysOn Availability Groups, que es la recomendaci√≥n actual de Microsoft. AlwaysOn ofrece mejor rendimiento, m√°s flexibilidad y soporte para m√∫ltiples bases de datos secundarias."
            },
            {
                question: "¬øPor qu√© es importante que las operaciones de recuperaci√≥n sean idempotentes?",
                options: {
                    A: "Para que se ejecuten m√°s r√°pido.",
                    B: "Para garantizar que ejecutar una operaci√≥n de recuperaci√≥n m√∫ltiples veces produzca el mismo resultado que ejecutarla una vez, evitando efectos duplicados o inconsistentes.",
                    C: "Para reducir el espacio en disco del log.",
                    D: "No es importante que sean idempotentes."
                },
                correct: "B",
                explanation: "Las operaciones idempotentes son cruciales en sistemas de recuperaci√≥n porque durante el proceso de recuperaci√≥n, especialmente en modificaci√≥n diferida, una operaci√≥n puede necesitar ejecutarse m√∫ltiples veces. Si no es idempotente, podr√≠a producir efectos duplicados o estados inconsistentes en la base de datos."
            },
            {
                question: "¬øQu√© restricci√≥n se establece entre el sistema de recuperaci√≥n y el planificador de concurrencia?",
                options: {
                    A: "Las transacciones no pueden ejecutarse concurrentemente.",
                    B: "Una transacci√≥n no puede modificar un dato que est√° siendo accedido por otra transacci√≥n.",
                    C: "Solo se permite una transacci√≥n activa a la vez.",
                    D: "No existe ninguna restricci√≥n entre ambos sistemas."
                },
                correct: "B",
                explanation: "Para que el sistema de recuperaci√≥n funcione correctamente con transacciones concurrentes, se establece la restricci√≥n de que una transacci√≥n no puede modificar un dato que est√° siendo accedido por otra transacci√≥n. Esto es necesario porque cuando se produce un error, no es trivial determinar qu√© transacciones est√°n afectadas si m√∫ltiples transacciones modifican los mismos datos simult√°neamente."
            },
            {
                question: "¬øCu√°l es la diferencia principal entre almacenamiento vol√°til y no vol√°til en el contexto de recuperaci√≥n?",
                options: {
                    A: "El almacenamiento vol√°til es m√°s r√°pido pero se pierde al apagar el sistema, mientras que el no vol√°til persiste pero es m√°s lento.",
                    B: "Ambos tipos de almacenamiento persisten despu√©s de apagar el sistema.",
                    C: "El almacenamiento no vol√°til es m√°s r√°pido que el vol√°til.",
                    D: "No hay diferencia relevante para la recuperaci√≥n."
                },
                correct: "A",
                explanation: "El almacenamiento vol√°til (como RAM) es muy r√°pido pero se pierde cuando el sistema se apaga. El almacenamiento no vol√°til (como discos) persiste despu√©s de apagar el sistema pero es m√°s lento. Esta diferencia es crucial para la recuperaci√≥n: los datos en almacenamiento vol√°til se pierden en una ca√≠da del sistema, mientras que los datos en almacenamiento no vol√°til pueden recuperarse."
            },
            {
                question: "En un sistema de alta disponibilidad 24/7, ¬øqu√© caracter√≠stica es esencial?",
                options: {
                    A: "Tener solo una copia de la base de datos.",
                    B: "Poder sobreponerse a cualquier incidente de manera r√°pida y mantener el servicio activo continuamente.",
                    C: "No necesitar backups porque el sistema nunca falla.",
                    D: "Usar solo almacenamiento vol√°til."
                },
                correct: "B",
                explanation: "Los sistemas de alta disponibilidad 24/7 est√°n dise√±ados para estar activos continuamente y poder sobreponerse r√°pidamente a cualquier incidente. Esto requiere soluciones como replicaci√≥n, bases de datos standby, y mecanismos de conmutaci√≥n por error autom√°tica para minimizar el tiempo de inactividad."
            }
        ];

        let userAnswers = {};
        let currentQuestionIndex = 0;

        function initTest() {
            const container = document.getElementById('test-questions');
            container.innerHTML = '';
            userAnswers = {};
            currentQuestionIndex = 0;
            document.getElementById('test-results').style.display = 'none';
            
            testQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'test-question';
                questionDiv.id = `question-${index}`;
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <h4>Pregunta ${index + 1} de ${testQuestions.length}</h4>
                        <div class="question-text">${q.question}</div>
                    </div>
                    <div class="question-options">
                        ${Object.entries(q.options).map(([key, value]) => `
                            <label class="option-label">
                                <input type="radio" name="question-${index}" value="${key}" onchange="selectAnswer(${index}, '${key}')">
                                <span class="option-text"><strong>${key}.</strong> ${value}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div id="feedback-${index}" class="feedback" style="display: none;"></div>
                `;
                container.appendChild(questionDiv);
            });

            const submitButton = document.createElement('button');
            submitButton.className = 'btn-primary';
            submitButton.textContent = 'Enviar Respuestas';
            submitButton.style.marginTop = '20px';
            submitButton.onclick = submitTest;
            container.appendChild(submitButton);
        }

        function selectAnswer(questionIndex, answer) {
            userAnswers[questionIndex] = answer;
            showFeedback(questionIndex, answer);
        }

        function showFeedback(questionIndex, selectedAnswer) {
            const question = testQuestions[questionIndex];
            const feedbackDiv = document.getElementById(`feedback-${questionIndex}`);
            const isCorrect = selectedAnswer === question.correct;
            
            feedbackDiv.style.display = 'block';
            feedbackDiv.className = `feedback ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}`;
            feedbackDiv.innerHTML = `
                <div class="feedback-icon">
                    <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                </div>
                <div class="feedback-text">
                    <strong>${isCorrect ? '¬°Correcto!' : 'Incorrecto'}</strong>
                    <p>${question.explanation}</p>
                    ${!isCorrect ? `<p><strong>Respuesta correcta: ${question.correct}</strong></p>` : ''}
                </div>
            `;
        }

        function submitTest() {
            let correct = 0;
            let incorrect = 0;
            const results = [];

            testQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === q.correct;
                
                if (isCorrect) {
                    correct++;
                } else {
                    incorrect++;
                }

                results.push({
                    question: q.question,
                    userAnswer: userAnswer || 'No respondida',
                    correctAnswer: q.correct,
                    isCorrect: isCorrect,
                    explanation: q.explanation
                });
            });

            displayResults(correct, incorrect, results);
        }

        function displayResults(correct, incorrect, results) {
            const total = testQuestions.length;
            const percentage = Math.round((correct / total) * 100);
            
            document.getElementById('test-questions').style.display = 'none';
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.style.display = 'block';
            
            const resultsContent = document.getElementById('results-content');
            resultsContent.innerHTML = `
                <div class="results-summary">
                    <div class="result-stat">
                        <div class="stat-icon correct">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">${correct}</div>
                            <div class="stat-label">Correctas</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon incorrect">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">${incorrect}</div>
                            <div class="stat-label">Incorrectas</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon total">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">${percentage}%</div>
                            <div class="stat-label">Calificaci√≥n</div>
                        </div>
                    </div>
                </div>
                <div class="results-details">
                    <h4>Detalle de Respuestas:</h4>
                    ${results.map((result, index) => `
                        <div class="result-item ${result.isCorrect ? 'result-correct' : 'result-incorrect'}">
                            <div class="result-question-number">Pregunta ${index + 1}</div>
                            <div class="result-question-text">${result.question}</div>
                            <div class="result-answer">
                                <span class="answer-label">Tu respuesta:</span>
                                <span class="answer-value ${result.isCorrect ? 'correct' : 'incorrect'}">
                                    ${result.userAnswer || 'No respondida'}
                                </span>
                                ${!result.isCorrect ? `
                                    <span class="answer-label">Respuesta correcta:</span>
                                    <span class="answer-value correct">${result.correctAnswer}</span>
                                ` : ''}
                            </div>
                            <div class="result-explanation">${result.explanation}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('restart-test').onclick = () => {
                document.getElementById('test-questions').style.display = 'block';
                resultsDiv.style.display = 'none';
                initTest();
            };
        }

        // Inicializar el test cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initTest();
        });
    </script>
    <style>
        .test-question {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .test-question:hover {
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1);
        }

        .question-header {
            margin-bottom: 15px;
        }

        .question-header h4 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-label:hover {
            border-color: #4CAF50;
            background: #f1f8f4;
        }

        .option-label input[type="radio"] {
            margin-right: 10px;
            margin-top: 3px;
            cursor: pointer;
        }

        .option-label input[type="radio"]:checked + .option-text {
            color: #4CAF50;
            font-weight: 600;
        }

        .option-text {
            flex: 1;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .feedback-correct {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
        }

        .feedback-incorrect {
            background: #ffebee;
            border: 2px solid #f44336;
        }

        .feedback-icon {
            font-size: 24px;
        }

        .feedback-correct .feedback-icon {
            color: #4CAF50;
        }

        .feedback-incorrect .feedback-icon {
            color: #f44336;
        }

        .feedback-text {
            flex: 1;
        }

        .feedback-text strong {
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .feedback-text p {
            margin: 5px 0;
            color: #555;
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-stat {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.correct {
            background: #e8f5e9;
            color: #4CAF50;
        }

        .stat-icon.incorrect {
            background: #ffebee;
            color: #f44336;
        }

        .stat-icon.total {
            background: #e3f2fd;
            color: #2196F3;
        }

        .stat-info {
            flex: 1;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .results-details {
            margin-top: 30px;
        }

        .results-details h4 {
            margin-bottom: 20px;
            color: #333;
        }

        .result-item {
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 5px solid;
        }

        .result-correct {
            background: #e8f5e9;
            border-left-color: #4CAF50;
        }

        .result-incorrect {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .result-question-number {
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        .result-question-text {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .result-answer {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .answer-label {
            font-weight: 600;
            color: #666;
        }

        .answer-value {
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
        }

        .answer-value.correct {
            background: #4CAF50;
            color: white;
        }

        .answer-value.incorrect {
            background: #f44336;
            color: white;
        }

        .result-explanation {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            color: #555;
            font-style: italic;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .results-summary {
                grid-template-columns: 1fr;
            }
        }

        /* Estilos para diagramas Mermaid */
        .diagram-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .diagram-container h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .diagram-container .mermaid {
            background: white;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            text-align: center;
        }

        .diagram-container .mermaid svg {
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 768px) {
            .diagram-container {
                padding: 15px;
            }
            
            .diagram-container .mermaid {
                padding: 15px;
            }
        }
    </style>
</body>
</html>
